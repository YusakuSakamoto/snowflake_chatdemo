# [[NORMALIZE_JA]] 設計書

## 概要

NORMALIZE_JAは、日本語文字列を統一的な表記に変換するユーザー定義関数（UDF）である。全角半角の統一、空白・記号の除去、法人格の除去、ひらがなのカタカナ化等を実施し、エンティティ名称の表記揺れを吸収して名称解決の精度を向上させる。

## 業務上の意味

顧客名や部署名、案件名などの固有名詞は、入力者によって全角半角や記号の使い方が異なり、同一エンティティでも複数の表記が存在する。このような表記揺れを放置すると、名称検索時に一致せず、誤った候補を返したり、候補が見つからなかったりする。本関数は、入力文字列を統一的なルールで正規化することで、名称解決の精度を大幅に向上させる。

## 設計上の位置づけ

NORMALIZE_JAはAPP_PRODUCTIONスキーマに配置され、以下の名称解決関連オブジェクトから参照される。

- [[RESOLVE_ENTITY_ALIAS]]: 名称解決プロシージャ内で、ユーザー入力文字列の正規化に使用
- DIM_ENTITY_ALIASの構築処理: エイリアステーブルへのデータ投入時に、生の名称から正規化名称を生成

本関数は汎用的な正規化を行うため、顧客名、案件名、オーダー名など、部署名以外のエンティティ全般に適用される。部署名については、より特化したNORMALIZE_JA_DEPT関数を併用する。

## 機能

1. Unicode正規化（NFKC）
   - 全角英数字を半角に変換
   - 結合文字を単一文字に変換

2. 空白の除去
   - 文字列前後のトリミング
   - 文字列中の空白・全角空白をすべて削除

3. 小文字化
   - 英字をすべて小文字に変換

4. 法人格の除去
   - 株式会社、有限会社、合同会社、（株）、㈱、inc.、ltd.、co.、company、limited等を削除

5. 記号の除去
   - 括弧、ハイフン、アンダースコア、スラッシュ、ピリオド、カンマ、中点等を削除

6. ひらがなのカタカナ化
   - ひらがな（U+3041〜U+3096）をカタカナ（U+30A1〜U+30F6）に変換

7. その他の正規化
   - 第n期の表記統一（「第1期」→「1期」）
   - 長音記号の連続を単一化（「ーー」→「ー」）

## パラメータ

- s (STRING): 正規化対象の文字列
  - NULL入力の場合はNULLを返却

## 利用シーン

- エンティティ名称の正規化: DIM_ENTITY_ALIASテーブルへのデータ投入時に、生の名称からalias_normalizedカラムを生成
- 名称解決時の正規化: ユーザー入力文字列を正規化し、DIM_ENTITY_ALIASのalias_normalizedカラムと照合
- 顧客名・案件名・オーダー名の標準化: 複数の表記が存在する固有名詞を統一形式に変換
- LIKEクエリの補助: 正規化後の文字列を用いることで、部分一致検索の精度を向上
- データクリーニング: マスタデータの重複排除や名寄せ処理の前処理として使用
