# NORMALIZE_JA_DEPT 設計書

## 概要

NORMALIZE_JA_DEPTは、部署名に特化した日本語文字列正規化関数である。NORMALIZE_JAの機能に加え、部署名の語尾（部、課、室、グループ、G、ユニット、チーム）を除去することで、より柔軟な部署名マッチングを実現する。

## 業務上の意味

部署名は、正式名称では「デジタルイノベーション部」であっても、日常会話やドキュメントでは「デジタルイノベーション」「デジタルイノベ部」「デジタルイノベーショングループ」などと表記されることがある。このような語尾の有無や種類の違いを吸収することで、ユーザーが口頭表現に近い形で部署名を指定しても、正しい部署エンティティを特定できるようになる。

## 設計上の位置づけ

NORMALIZE_JA_DEPTはAPP_PRODUCTIONスキーマに配置され、RESOLVE_ENTITY_ALIASプロシージャから参照される。部署名の名称解決時に、NORMALIZE_JAとNORMALIZE_JA_DEPTの両方で正規化した結果を用いてDIM_ENTITY_ALIASテーブルを検索することで、語尾の有無に依存しない柔軟なマッチングを実現している。

## 機能

1. NORMALIZE_JAと同等の正規化
   - Unicode正規化（NFKC）
   - 空白・記号の除去
   - 小文字化
   - 法人格の除去
   - ひらがなのカタカナ化

2. 部署名語尾の除去
   - 部、課、室、グループ、G、ユニット、チームを文字列末尾から削除
   - ただし、「本部」の「本」は除去しない（否定先読み正規表現で制御）

## パラメータ

- s (STRING): 正規化対象の部署名文字列
  - NULL入力の場合はNULLを返却

## 利用シーン

- 部署名の名称解決: ユーザーが「デジタルイノベーション」と入力した場合でも、「デジタルイノベーション部」をマッチング
- 略称の吸収: 「デジタルイノベ部」「デジタルイノベG」といった略称・俗称を標準名称に変換
- 口頭表現への対応: 会議やチャットでの口頭表現に近い入力でも正しい部署を特定
- エイリアステーブルの構築: DIM_ENTITY_ALIASに部署エイリアスを登録する際、NORMALIZE_JAとNORMALIZE_JA_DEPTの両方で正規化した値を格納
- 組織変更時の名称揺れ吸収: 部署名の語尾が変更された場合（「部」→「室」、「課」→「グループ」等）でも、過去データとの照合が可能
