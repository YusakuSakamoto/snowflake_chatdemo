# ビュー設計：[[design.V_PROJECT_FACT]]

## 概要
[[APP_PRODUCTION.V_PROJECT_FACT]] は、取込テーブル（案件明細）の 生データ粒度（明細粒度）を保持したまま、参照・分析で扱いやすい入口として提供するファクト VIEW である。

本スキーマでは、[[design.V_PROJECT_MASTER]] / [[design.V_ORDER_MASTER]] / [[design.V_CUSTOMER_MASTER]] / [[design.V_INVOICE]] などの「正規化 VIEW 群」が
粒度を固定して代表値や集約値を提供する一方、[[design.V_PROJECT_FACT]] は 集約しないことを目的とする。

- マスタ VIEW 群：粒度をまとめる（1案件、1顧客、1請求…）
- 本 VIEW：粒度を保つ（取込の1行＝1レコードに近い）

## 位置づけ（レイヤ）
- 入力：取込（Raw / Landing）層の案件明細テーブル（[[design.ANKEN_MEISAI]]）
- 出力：提供（Views / Normalized）層のファクト VIEW
- 下流利用：
  - 明細粒度のドリルダウン（集約の根拠確認）
  - データ品質・欠損の可視化（NULLや揺れの把握）
  - セマンティックモデルで「ファクト粒度を保持した分析」を行う場合の入力候補

本 VIEW は「正本ファクトテーブル」ではなく、デモ用途の参照入口として機能する。

## 粒度（Grain）
本 VIEW の 1レコードは、取込テーブルの明細行（生データ粒度）を表す。

- 取込データの 1行に近い粒度を保持する
- 代表値選択（`ANY_VALUE`）や集約（SUM）を行わない
- JOIN で粒度を崩さないよう、「粒度の維持」を最優先とする

## カラムの考え方（最小セット）
本 VIEW は、案件・オーダ・請求に関する参照キーや識別子を保持し、下流での結合・フィルタの入口となる。

- レコードの識別（取込行を指すID等）
- 案件識別（案件番号・枝番・年度）
- オーダ識別（オーダ番号）
- 請求識別（請求番号）
- 参照補助（顧客見積依頼番号、有効無効フラグ等）

本 VIEW は「ファクト粒度の保持」が目的であり、
表示向けの名称・説明・集計済金額などは、他 VIEW（マスタ / 請求 VIEW）側に寄せる。

## 取込層と同じ“割り切り”を持つ
[[design.V_PROJECT_FACT]] は、取込層の思想（止めない／保持する）をそのまま引き継ぐ。

- 欠損（NULL）を許容する
- 表現揺れを許容する
- 重複行を許容する

この VIEW の目的は「正しいファクトを確定させる」ことではなく、
「集約や正規化の前の事実を参照できる入口」を作ることにある。

## 使い分けの指針（いつ使うか）
- [[design.V_PROJECT_MASTER]] を使う：案件単位で分析したい（粒度をまとめたい）
- [[design.V_INVOICE]] を使う：請求×計上月の売上を見たい（集計済が欲しい）
- [[design.V_PROJECT_FACT]] を使う：集計根拠を確認したい／明細で条件を切りたい／欠損や揺れを見たい

「マスタ VIEW 群で見える数字」と「生データの実体」をつなぐための位置づけである。

## 運用上の注意
- 本 VIEW は集約しないため、クエリのスキャン量が増えやすい（デモ用途であることを前提）
- 分析用途では、まずマスタ VIEW / 請求 VIEW を使い、必要なときに本 VIEW へドリルダウンする
- 将来的にファクト正本テーブルを設ける場合、本 VIEW は「暫定入口」として位置づけを見直す

## 関連
- スキーマ設計：[[design.APP_PRODUCTION]]
- 取込テーブル設計：[[design.ANKEN_MEISAI]]
- 関連 VIEW：[[design.V_PROJECT_MASTER]] / [[design.V_ORDER_MASTER]] / [[design.V_CUSTOMER_MASTER]] / [[design.V_INVOICE]]
- セマンティックモデル：ファクト粒度を採用する場合の入力候補（別途定義）

---
